<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Data Platform Migration Upgrade – includes</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cloudworkshop.blob.core.windows.net/styles/labstyles.css"></link>
</head>
<body>
<p><img src="images/HeaderPic.png" title="Microsoft Cloud Workshops" /></p>
<div class="MCWHeader1">
<p>Data platform upgrade and migration</p>
</div>
<div class="MCWHeader2">
<p>Hands-on lab step-by-step</p>
</div>
<div class="MCWHeader3">
<p>March 2018</p>
</div>
<p>Information in this document, including URL and other Internet Web site references, is subject to change without notice. Unless otherwise noted, the example companies, organizations, products, domain names, e-mail addresses, logos, people, places, and events depicted herein are fictitious, and no association with any real company, organization, product, domain name, e-mail address, logo, person, place or event is intended or should be inferred. Complying with all applicable copyright laws is the responsibility of the user. Without limiting the rights under copyright, no part of this document may be reproduced, stored in or introduced into a retrieval system, or transmitted in any form or by any means (electronic, mechanical, photocopying, recording, or otherwise), or for any purpose, without the express written permission of Microsoft Corporation.</p>
<p>Microsoft may have patents, patent applications, trademarks, copyrights, or other intellectual property rights covering subject matter in this document. Except as expressly provided in any written license agreement from Microsoft, the furnishing of this document does not give you any license to these patents, trademarks, copyrights, or other intellectual property.</p>
<p>The names of manufacturers, products, or URLs are provided for informational purposes only and Microsoft makes no representations and warranties, either expressed, implied, or statutory, regarding these manufacturers or the use of the products with any Microsoft technologies. The inclusion of a manufacturer or product does not imply endorsement of Microsoft of the manufacturer or product. Links may be provided to third party sites. Such sites are not under the control of Microsoft and Microsoft is not responsible for the contents of any linked site or any link contained in a linked site, or any changes or updates to such sites. Microsoft is not responsible for webcasting or any other form of transmission received from any linked site. Microsoft is providing these links to you only as a convenience, and the inclusion of any link does not imply endorsement of Microsoft of the site or the products contained therein. © 2018 Microsoft Corporation. All rights reserved.</p>
<p>Microsoft and the trademarks listed at https://www.microsoft.com/en-us/legal/intellectualproperty/Trademarks/Usage/General.aspx are trademarks of the Microsoft group of companies. All other trademarks are property of their respective owners.</p>
<p><strong>Contents</strong> - <a href="#data-platform-upgrade-and-migration-hands-on-lab-unguided">Data platform upgrade and migration hands-on lab unguided</a> - <a href="#abstract-and-learning-objectives">Abstract and learning objectives</a> - <a href="#overview">Overview</a> - <a href="#solution-architecture">Solution Architecture</a> - <a href="#requirements">Requirements</a> - <a href="#before-the-hands-on-lab">Before the hands-on lab</a> - <a href="#task-1-provision-a-lab-virtual-machine-vm">Task 1: Provision a lab virtual machine (VM)</a> - <a href="#task-2-connect-to-your-lab-vm">Task 2: Connect to your lab VM</a> - <a href="#exercise-1-deploy-sql-server-instances">Exercise 1: Deploy SQL Server instances</a> - <a href="#task-1-provision-an-azure-vm">Task 1: Provision an Azure VM</a> - <a href="#task-2-allow-remote-systems-to-connect-with-the-sql-server-vm">Task 2: Allow remote systems to connect with the SQL Server VM</a> - <a href="#task-3-install-sql-server-2017">Task 3: Install SQL Server 2017</a> - <a href="#task-4-configure-the-vm-as-an-application-server">Task 4: Configure the VM as an application server</a> - <a href="#task-5-install-sql-server-2008-r2">Task 5: Install SQL Server 2008 R2</a> - <a href="#task-6-open-port-1433-on-the-windows-firewall-of-the-vm">Task 6: Open port 1433 on the Windows Firewall of the VM</a> - <a href="#task-7-install-the-adventureworks-sample-database">Task 7: Install the AdventureWorks sample database</a> - <a href="#task-8-update-sql-server-service-accounts-using-configuration-manager">Task 8: Update SQL Server service accounts using Configuration Manager</a> - <a href="#exercise-2-perform-an-assessment-for-a-move-to-azure-sql-database">Exercise 2: Perform an assessment for a move to Azure SQL Database</a> - <a href="#task-1-perform-an-assessment">Task 1: Perform an assessment</a> - <a href="#exercise-3-upgrade-the-sql-server-2008-database-to-sql-server-2017">Exercise 3: Upgrade the SQL Server 2008 database to SQL Server 2017</a> - <a href="#task-1-create-a-shared-folder-for-the-database-migration">Task 1: Create a shared folder for the database migration</a> - <a href="#task-2-migrate-using-data-migration-assistant">Task 2: Migrate using Data Migration Assistant</a> - <a href="#exercise-4-post-upgrade-enhancement">Exercise 4: Post Upgrade Enhancement</a> - <a href="#task-1-table-compression">Task 1: Table Compression</a> - <a href="#task-2-clustered-columnstore-index">Task 2: Clustered ColumnStore Index</a> - <a href="#exercise-5-setup-oracle-11g-express-edition">Exercise 5: Setup Oracle 11g Express Edition</a> - <a href="#task-1-install-oracle-xe">Task 1: Install Oracle XE</a> - <a href="#task-2-install-oracle-data-access-components">Task 2: Install Oracle Data Access Components</a> - <a href="#task-3-install-sql-server-migration-assistant-ssma-7x-for-oracle">Task 3: Install SQL Server Migration Assistant (SSMA) 7.x for Oracle</a> - <a href="#task-4-install-dbforge-fusion-tool-trial-version">Task 4: Install dbForge Fusion tool (trial version)</a> - <a href="#task-5-create-the-northwind-database-in-oracle-11g-xe">Task 5: Create the Northwind database in Oracle 11g XE</a> - <a href="#task-6-configure-the-starter-application-to-use-oracle">Task 6: Configure the Starter Application to use Oracle</a> - <a href="#exercise-6-migrate-the-oracle-database-to-sql-server-2017">Exercise 6: Migrate the Oracle database to SQL Server 2017</a> - <a href="#task-1-migrate-the-oracle-database-to-sql-server-2017-using-ssma">Task 1: Migrate the Oracle database to SQL Server 2017 using SSMA</a> - <a href="#exercise-7-migrate-the-application">Exercise 7: Migrate the application</a> - <a href="#task-1-create-a-new-entity-model-against-sql-server">Task 1: Create a new Entity Model against SQL Server</a> - <a href="#task-2-modify-application-code">Task 2: Modify Application Code</a> - <a href="#after-the-hands-on-lab">After the hands-on lab</a> - <a href="#task-1-delete-the-resource-group">Task 1: Delete the resource group</a></p>
<h1 id="data-platform-upgrade-and-migration-hands-on-lab-unguided">Data platform upgrade and migration hands-on lab unguided</h1>
<h2 id="abstract-and-learning-objectives">Abstract and learning objectives</h2>
<p>This hands-on lab is designed to help attendees better understand how to build a Proof-of-Concept (POC) and conduct a site analysis for a customer to compare cost, performance, and level of effort required to migrate from Oracle to SQL Server. You will evaluate the dependent applications and reports that will need to be updated, and come up with a migration plan. In addition, attendees will help the customer take advantage of new SQL Server features to improve performance and resiliency, as well as explore ways to migrate from an old version of SQL Server to the newest version and consider the impact of migrating from on-premises to the cloud.</p>
<p>Learning Objectives:</p>
<ul>
<li><p>Migrate from Oracle to SQL Server using SQL Server Migration Assistant</p></li>
<li><p>Migrate between different SQL Server editions using Data Migration Assistant</p></li>
<li><p>Use advanced SQL Server features, such as JavaScript Object Notation (JSON) data store, table compression, Transparent Data Encryption, and clustered ColumnStore indexing</p></li>
<li><p>Consider the steps required to update existing applications to use the new data platform</p></li>
<li><p>Analyze and improve database performance</p></li>
<li><p>Implement high availability using Stretch Database and AlwaysOn Availability Groups</p></li>
</ul>
<h2 id="overview">Overview</h2>
<p>World Wide Importers (WWI) has experienced significant growth in the last few years. In addition to predictable growth, they’ve had a substantial amount of growth in the data they store in their data warehouse. Their data warehouse is starting to show its age; slowing down during extract, transform, and load (ETL) operations and during critical queries. It was built on SQL Server 2008 R2 Standard Edition.</p>
<p>The WWI CIO has recently read about new performance enhancements of SQL Server 2017. She is excited about clustered ColumnStore indexes. In addition, she has chosen to upgrade to Enterprise Edition. She’s hoping that table compression will improve performance, backup times, and lessen the load on the Storage Area Network (SAN).</p>
<p>WWI is concerned about upgrading their database to SQL Server 2017 or Azure SQL Database. The data warehouse has been successful for a long time. As it has grown, it has filled with data, stored procedures, views, and security. WWI wants assurance that if it moves its data store, it won’t run into any incompatibilities with the storage engine of SQL Server 2017.</p>
<p>WWI’s CIO would like a POC of a data warehouse move and proof that the new technology will help ETL and query performance.</p>
<h2 id="solution-architecture">Solution Architecture</h2>
<p>Below is a diagram of the solution architecture you will build in this lab. Please study this carefully, so you understand the whole of the solution as you are working on the various components.</p>
<figure>
<img src="images/Hands-onlabunguided-Dataplatformupgradeandmigrationimages/media/image2.png" title="Preferred Solution diagram" alt="This solution diagram is divided in to Microsoft Azure, and On Premises. Microsoft Azure includes SQL Server 2017 in a VM as an Always On Secondary, and Azure SQL Data Warehouse for a stretch table. On Premise includes the following elements: API App for vendor connections; Web App for Internet Sales Transactions; ASP.NET Core App for inventory management; SQL Server 2017 OLTP for Always On and JSON store; SSRS 2017 for Reporting of OLTP, Data Warehouse, and Cubes; SSIS 2017 for a Data Warehouse Load; Excel for reporting; SQL Server 2017 Enterprise for a Data Warehouse; and SSAS 2017 for a Data Warehouse." /><figcaption>This solution diagram is divided in to Microsoft Azure, and On Premises. Microsoft Azure includes SQL Server 2017 in a VM as an Always On Secondary, and Azure SQL Data Warehouse for a stretch table. On Premise includes the following elements: API App for vendor connections; Web App for Internet Sales Transactions; ASP.NET Core App for inventory management; SQL Server 2017 OLTP for Always On and JSON store; SSRS 2017 for Reporting of OLTP, Data Warehouse, and Cubes; SSIS 2017 for a Data Warehouse Load; Excel for reporting; SQL Server 2017 Enterprise for a Data Warehouse; and SSAS 2017 for a Data Warehouse.</figcaption>
</figure>
<p>The solution begins with using the Microsoft Data Migration Assistant to perform an assessment to see what potentials issues need to be addressed in upgrading the database to SQL Server 2017 or Azure SQL Database. After correcting any issues, the SQL Server 2008 database is migrated to SQL Server 2017 Enterprise, using Data Migration Assistant. A shared folder is created for storing a backup of the database, which is used by Data Migration Assistant to move the database to SQL Server 2017. Two new features of SQL Server 2017, Table Compression and ColumnStore Index, will be applied to demonstrate vale from the upgrade. For the ColumnStore Index, a new table based on the existing FactResellerSales table will be created, and a ColumnStore index applied. Next, the Oracle XE database supporting the application will be migrating to SQL Server 2017 Enterprise using SQL Server Migration Assistant (SSMA) 7.x for Oracle. Once the Oracle database has been migrated, the NorthwindMVC application is updated, so it targets SQL Server 2017 instead of Oracle. The entity models are updated against SQL Server, and code updates are made to use the new Entity Framework context based on SQL Server. Corrections to stored procedures are made due to differences in how stored procedures are accessed in Oracle versus SQL Server.</p>
<h2 id="requirements">Requirements</h2>
<ul>
<li><p>Microsoft Azure subscription must be pay-as-you-go or MSDN.</p>
<ul>
<li>Trial subscriptions will not work.</li>
</ul></li>
<li><p>A virtual machine configured with:</p>
<ul>
<li><p>Visual Studio Community 2017 or later</p></li>
<li><p>Azure SDK 2.9 or later (Included with Visual Studio 2017)</p></li>
</ul></li>
</ul>
<h2 id="exercise-1-deploy-sql-server-instances">Exercise 1: Deploy SQL Server instances</h2>
<p>Duration: 60 minutes</p>
<p>In this exercise, you will create an Azure VM that contains instances of both SQL Server 2008 and SQL Server 2017.</p>
<h3 id="task-1-provision-an-azure-vm">Task 1: Provision an Azure VM</h3>
<p>In this task, you will provision a virtual machine (VM) in Azure which can host instances of both SQL Server 2008 and SQL Server 2017. The VM with use the Windows Server 2012 R2 Datacenter image. Note, we are using an older version of Windows Server because SQL Server 2008 R2 is not supported on Windows Server 2016.</p>
<h4 id="tasks-to-complete">Tasks to Complete</h4>
<ul>
<li><p>Provision a VM of Windows Server 2012 R2.</p>
<ul>
<li>Be sure to use an admin account user name of holuser, with a password of Password.1!!.</li>
</ul></li>
</ul>
<h4 id="exit-criteria">Exit Criteria</h4>
<ul>
<li>You are able to Remote Desktop into the VM.</li>
</ul>
<h3 id="task-2-allow-remote-systems-to-connect-with-the-sql-server-vm">Task 2: Allow remote systems to connect with the SQL Server VM</h3>
<p>In this task, you will create a network security rule for the VM that allows remote systems to connect with SQL Server.</p>
<h4 id="tasks-to-complete-1">Tasks to Complete</h4>
<ul>
<li>Add a network security rule allowing connectivity with SQL Server on port 1433.</li>
</ul>
<h4 id="exit-criteria-1">Exit Criteria</h4>
<ul>
<li>Port 1433 is open on the VM.</li>
</ul>
<h3 id="task-3-install-sql-server-2017">Task 3: Install SQL Server 2017</h3>
<p>In this task, you will install SQL Server 2017 and Microsoft SQL Server Management Studio (SSMS) on the VM.</p>
<h4 id="tasks-to-complete-2">Tasks to Complete</h4>
<ul>
<li><p>Install SQL Server 2017 Developer Edition on the VM</p>
<ul>
<li><p><a href="https://www.microsoft.com/sql-server/sql-server-downloads" class="uri">https://www.microsoft.com/sql-server/sql-server-downloads</a></p></li>
<li><p>Ensure the SQL Server Database Engine runs under the holuser Windows account.</p></li>
<li><p>Enable Mixed Mode Authentication</p>
<ul>
<li>Ensure the SA password is set to Password.1!!</li>
</ul></li>
<li><p>Make sure to add the holuser to the SQL Server Administrators group.</p></li>
</ul></li>
<li><p>Install SQL Server Management Studio (SSMS) 17.</p></li>
</ul>
<h4 id="exit-criteria-2">Exit Criteria</h4>
<p>You have successfully installed SQL Server 2017 Developer Edition and SSMS 17 on the VM.</p>
<h3 id="task-4-configure-the-vm-as-an-application-server">Task 4: Configure the VM as an application server</h3>
<p>In this task, you will configure the VM to be an application server. This is necessary to install the required .NET components on the server prior to installing SQL Server 2008 R2.</p>
<h4 id="tasks-to-complete-3">Tasks to Complete</h4>
<ul>
<li>Add the Application Server role the VM, and include .NET Framework 3.5 features</li>
</ul>
<h4 id="exit-criteria-3">Exit Criteria</h4>
<ul>
<li>The VM is configured as an Application Server, with the necessary .NET 3.5 features installed.</li>
</ul>
<h3 id="task-5-install-sql-server-2008-r2">Task 5: Install SQL Server 2008 R2</h3>
<p>In this task, you will install SQL Server 2008 R2 on the VM.</p>
<h4 id="tasks-to-complete-4">Tasks to Complete</h4>
<ul>
<li><p>Install SQL Server 2008 R2 Express with Advanced Services on the VM</p>
<ul>
<li><p><a href="https://www.microsoft.com/download/details.aspx?id=30438" class="uri">https://www.microsoft.com/download/details.aspx?id=30438</a></p></li>
<li><p>Be sure that the SQL Database Engine runs under the holuser Windows account.</p></li>
<li><p>Enable Mixed Mode Authentication</p>
<ul>
<li>Ensure the SA password is set to Password.1!!</li>
</ul></li>
<li><p>Ensure the holuser account is added to the SQL Server Administrators group</p></li>
</ul></li>
</ul>
<h4 id="exit-criteria-4">Exit Criteria</h4>
<ul>
<li>You have successfully installed both versions of SQL Server on the same VM.</li>
</ul>
<h3 id="task-6-open-port-1433-on-the-windows-firewall-of-the-vm">Task 6: Open port 1433 on the Windows Firewall of the VM</h3>
<p>In this task, you will add rules to the VM’s Windows firewall to allow access to SQL Server via port 1433 by other machines.</p>
<h4 id="tasks-to-complete-5">Tasks to Complete</h4>
<ul>
<li>Add an inbound port rule to the Windows Firewall on the VM to allow communication over TCP port 1433.</li>
</ul>
<h4 id="exit-criteria-5">Exit Criteria</h4>
<ul>
<li>Port 1433 is open on the VM’s firewall</li>
</ul>
<h3 id="task-7-install-the-adventureworks-sample-database">Task 7: Install the AdventureWorks sample database</h3>
<p>In this task, you will install the AdventureWorks database in SQL 2008 R2, as the source database to migrate.</p>
<h4 id="tasks-to-complete-6">Tasks to Complete</h4>
<ul>
<li><p>Download the AdventureWorks 2008R2 DW script from: <a href="https://github.com/Microsoft/sql-server-samples/releases/tag/adventureworks2008r2" class="uri">https://github.com/Microsoft/sql-server-samples/releases/tag/adventureworks2008r2</a></p></li>
<li><p>Execute instawdwdb.sql against the SQL Server 2008 instance on your VM</p></li>
<li><p>Rename the database to WorldWideImporters</p></li>
</ul>
<h4 id="exit-criteria-6">Exit Criteria</h4>
<ul>
<li>You have successfully created the WorldWideImporters database.</li>
</ul>
<h3 id="task-8-update-sql-server-service-accounts-using-configuration-manager">Task 8: Update SQL Server service accounts using Configuration Manager</h3>
<p>In this task, you will ensure the SQL Server services in running under the holuser account, and that remote TCP/IP connections are allowed.</p>
<h4 id="tasks-to-complete-7">Tasks to Complete</h4>
<ul>
<li><p>Set the services account for the SQL Server service (in both the SQL Server 2008 and 2017 instances) to use the holuser Windows account.</p></li>
<li><p>Ensure that remote TCP/IP connections are allowed to the SQL Server 2017 instance.</p></li>
<li><p>Enable the SA login with the password Password.1!!</p></li>
<li><p>Create a new, empty database called Northwind in the SQL Server 2017 instance</p></li>
</ul>
<h4 id="exit-criteria-7">Exit Criteria</h4>
<ul>
<li>You have successfully created the Northwind target database in SQL Server 2017, and can access this SQL Server using SQL Server credentials.</li>
</ul>
<h2 id="exercise-2-perform-an-assessment-for-a-move-to-azure-sql-database">Exercise 2: Perform an assessment for a move to Azure SQL Database</h2>
<p>Duration: 15 minutes</p>
<p>World Wide Importers would like an assessment to see what potential issues they would have to address in moving their database to Azure SQL Database.</p>
<h3 id="task-1-perform-an-assessment">Task 1: Perform an assessment</h3>
<h4 id="tasks-to-complete-8">Tasks to Complete</h4>
<ul>
<li>Use the Data Migration Assistant to perform an assessment for migrating the WorldWideImporters database to Azure SQL Database.</li>
</ul>
<h4 id="exit-criteria-8">Exit Criteria</h4>
<ul>
<li>You can review the assessment results.</li>
</ul>
<h2 id="exercise-3-upgrade-the-sql-server-2008-database-to-sql-server-2017">Exercise 3: Upgrade the SQL Server 2008 database to SQL Server 2017</h2>
<p>Duration: 30 minutes</p>
<p>World Wide Importers would like a Proof of Concept (POC) that moves their database to SQL Server 2017 Enterprise. They would like to know about any incompatible features that will block their eventual production move.</p>
<h3 id="task-1-create-a-shared-folder-for-the-database-migration">Task 1: Create a shared folder for the database migration</h3>
<p>In this task, you are going to create a shared folder that is accessible by both the source and target databases for the migration. This folder will store a backup of the database used for the migration process.</p>
<h4 id="tasks-to-complete-9">Tasks to Complete</h4>
<ul>
<li>Create a common shared folder on the VM for use as the “Shared location” used by Data Migration Assistant.</li>
</ul>
<h4 id="exit-criteria-9">Exit Criteria</h4>
<ul>
<li>You have a folder accessible by both SQL Servers for Data Migration Assistant to use as a shared location during migration.</li>
</ul>
<h3 id="task-2-migrate-using-data-migration-assistant">Task 2: Migrate using Data Migration Assistant</h3>
<h4 id="tasks-to-complete-10">Tasks to Complete</h4>
<ul>
<li><p>Migrate the WorldWideImporters database from SQL Server 2008 to SQL Server 2017 using the Data Migration Assistant.</p>
<ul>
<li><p>Be sure to use Windows Authentication</p></li>
<li><p>Uncheck Encrypt connection and Trusted server certificate</p></li>
</ul></li>
</ul>
<p>Exit Criteria</p>
<ul>
<li><p>Your results indicate a successful upgrade.</p>
<figure>
<img src="images/Hands-onlabunguided-Dataplatformupgradeandmigrationimages/media/image16.png" title="Migrate the WorldWideImporters database" alt="WorldWideImporters is highlighted under Databases in the Data Migration Assistant." /><figcaption>WorldWideImporters is highlighted under Databases in the Data Migration Assistant.</figcaption>
</figure></li>
</ul>
<h2 id="exercise-4-post-upgrade-enhancement">Exercise 4: Post Upgrade Enhancement</h2>
<p>Duration: 20 minutes</p>
<p>In this exercise, you will confirm that the POC was successful. To demonstrate value from the upgrade, the new features of SQL Server 2017 (Table Compression and ColumnStore Index) will be enabled to immediately show benefit.</p>
<h3 id="task-1-table-compression">Task 1: Table Compression</h3>
<h4 id="tasks-to-complete-11">Tasks to Complete</h4>
<ul>
<li><p>Take note of the data space and index space used by the FactInternetSales table.</p></li>
<li><p>Enable Table Compression (page type) on the FactInternetSales table.</p></li>
</ul>
<h4 id="exit-criteria-10">Exit Criteria</h4>
<ul>
<li>You observe a change in the data space and index space.</li>
</ul>
<h3 id="task-2-clustered-columnstore-index">Task 2: Clustered ColumnStore Index</h3>
<p>In this task, you will create a new table based on the existing FactResellerSales table and apply a ColumnStore index.</p>
<h4 id="tasks-to-complete-12">Tasks to Complete</h4>
<ul>
<li><p>Create a new table called ColumnStore_FactResellerSales from the FactResellersSales table.</p></li>
<li><p>Create a clustered ColumnStore index on the new table.</p></li>
<li><p>Query the tables and compare the execution plan query costs, batch percentage.</p></li>
<li><p>Query the tables with statistic IO on and compare the logical and lob logical reads.</p></li>
</ul>
<h4 id="exit-criteria-11">Exit Criteria</h4>
<ul>
<li><p>You observe a performance improvement.</p>
<figure>
<img src="images/Hands-onlabunguided-Dataplatformupgradeandmigrationimages/media/image17.png" title="Observe improvements" alt="Various performance improvements are highlighted on the Messages tab." /><figcaption>Various performance improvements are highlighted on the Messages tab.</figcaption>
</figure></li>
</ul>
<h2 id="exercise-5-setup-oracle-11g-express-edition">Exercise 5: Setup Oracle 11g Express Edition</h2>
<p>Duration: 45 minutes</p>
<p>In this exercise, you will install Oracle XE on your Lab VM, load a sample database supporting an application, and then migrate the database to SQL Server 2017.</p>
<h3 id="task-1-install-oracle-xe">Task 1: Install Oracle XE</h3>
<h4 id="tasks-to-complete-13">Tasks to Complete</h4>
<ul>
<li><p>Install Oracle XE on your lab VM from: <a href="http://www.oracle.com/technetwork/database/database-technologies/express-edition/downloads/index.html" class="uri">http://www.oracle.com/technetwork/database/database-technologies/express-edition/downloads/index.html</a></p></li>
<li><p>Be sure to set the SYS and SYSTEM password to Password.1!!</p></li>
</ul>
<h4 id="exit-criteria-12">Exit Criteria</h4>
<ul>
<li>You have successfully installed Oracle.</li>
</ul>
<h3 id="task-2-install-oracle-data-access-components">Task 2: Install Oracle Data Access Components</h3>
<h4 id="tasks-to-complete-14">Tasks to Complete</h4>
<ul>
<li><p>Install Oracle Data Access Components (ODAC) from <a href="http://www.oracle.com/technetwork/database/windows/downloads/index-090165.html" class="uri">http://www.oracle.com/technetwork/database/windows/downloads/index-090165.html</a></p></li>
<li><p>Be sure the install the 64-bit ODAC components</p></li>
<li><p>Ensure you configure ODP.NET and Oracle Providers for ASP.NET at machine-wide level</p></li>
</ul>
<h4 id="exit-criteria-13">Exit Criteria</h4>
<ul>
<li>You have successfully installed ODAC.</li>
</ul>
<h3 id="task-3-install-sql-server-migration-assistant-ssma-7.x-for-oracle">Task 3: Install SQL Server Migration Assistant (SSMA) 7.x for Oracle</h3>
<h4 id="tasks-to-complete-15">Tasks to Complete</h4>
<ul>
<li>Install SSMA 7.x from <a href="https://www.microsoft.com/en-us/download/details.aspx?id=54258" class="uri">https://www.microsoft.com/en-us/download/details.aspx?id=54258</a></li>
</ul>
<h4 id="exit-criteria-14">Exit Criteria</h4>
<ul>
<li>You have successfully installed SSMA on your Lab VM.</li>
</ul>
<h3 id="task-4-install-dbforge-fusion-tool-trial-version">Task 4: Install dbForge Fusion tool (trial version)</h3>
<p>In this task, you will install a third-party extension to Visual Studio to enable interaction with, and script execution for, the Oracle database in Visual Studio 2017 Community Edition. This step is necessary because the Oracle Developer Tools extension does not currently work with Visual Studio 2017 Community Edition.</p>
<h4 id="tasks-to-complete-16">Tasks to Complete</h4>
<ul>
<li>Install dbForge Fusion for Oracle Professional trial version from <a href="https://www.devart.com/dbforge/oracle/fusion/download.html" class="uri">https://www.devart.com/dbforge/oracle/fusion/download.html</a></li>
</ul>
<h4 id="exit-criteria-15">Exit Criteria</h4>
<ul>
<li>The dbForge Fusion extension is successfully installed in Visual Studio 2017.</li>
</ul>
<h3 id="task-5-create-the-northwind-database-in-oracle-11g-xe">Task 5: Create the Northwind database in Oracle 11g XE</h3>
<p>In this task, you will create a connection to the Oracle database on your Lab VM, and create a database called Northwind.</p>
<h4 id="tasks-to-complete-17">Tasks to Complete</h4>
<ul>
<li><p>Download the starter files from <a href="http://bit.ly/2rwxnwW" class="uri">http://bit.ly/2rwxnwW</a>. (Note the URL is cases sensitive)</p></li>
<li><p>Using Database Explorer provided under the Fusion menu installed by dbForge Fusion in Visual Studio, create a connection to the Oracle database.</p></li>
<li><p>Run the SQL scripts in order provided under the Oracle Scripts folder of the starter.</p></li>
</ul>
<h4 id="exit-criteria-16">Exit Criteria</h4>
<ul>
<li>You have created the Northwind database with schema and data in Oracle.</li>
</ul>
<h3 id="task-6-configure-the-starter-application-to-use-oracle">Task 6: Configure the Starter Application to use Oracle</h3>
<p>In this task, you will add the necessary configuration to the NorthwindMVC solution to connect to the Oracle database you created in the previous task.</p>
<h4 id="tasks-to-complete-18">Tasks to Complete</h4>
<ul>
<li>Modify the web.config of the NorthwindMVC web app so the OracleConnectionString points to your Oracle instance of Northwind.</li>
</ul>
<h4 id="exit-criteria-17">Exit Criteria</h4>
<ul>
<li><p>You can run the application and see the Dashboard from Northwind Traders load.<br />
</p>
<figure>
<img src="images/Hands-onlabunguided-Dataplatformupgradeandmigrationimages/media/image18.png" title="View the dashboard" alt="This is a screenshot of the Northwind Traders Dashboard." /><figcaption>This is a screenshot of the Northwind Traders Dashboard.</figcaption>
</figure></li>
</ul>
<h2 id="exercise-6-migrate-the-oracle-database-to-sql-server-2017">Exercise 6: Migrate the Oracle database to SQL Server 2017</h2>
<p>Duration: 30 minutes</p>
<p>In this exercise, you will migrate the Oracle database into SQL Server 2017 using SSMA.</p>
<h3 id="task-1-migrate-the-oracle-database-to-sql-server-2017-using-ssma">Task 1: Migrate the Oracle database to SQL Server 2017 using SSMA</h3>
<h4 id="tasks-to-complete-19">Tasks to Complete</h4>
<ul>
<li><p>Use SSMA to migrate the schema and data from the NW database on Oracle to the Northwind database in SQL Server 2017.</p>
<ul>
<li><p>Fix data type errors reported during schema conversion</p></li>
<li><p>In SQL Server 2017, Microsoft now by default requires that all type of assemblies (SAFE, EXTERNAL_ACCESS, UNSAFE) are authorized for UNSAFE access. Add the SSMA4OracleSQLServerCollections.NET and SSMA4OracleSQLServerExtensions.NET assemblies to the SQLCLR whitelist for the SQL Server 2017 instance.</p></li>
<li>Execute the script below in SSMS for each assembly. Note: The binary value for each assembly can be obtained by saving the assemblies as a script in SSMA.</li>
</ul>
<pre><code>USE master;

GO

DECLARE @clrName nvarchar(4000) = &#39;[INSERT ASSEMBLY NAME]&#39;

DECLARE @asmBin varbinary(max) = [INSERT BINARY];

DECLARE @hash varbinary(64);

SELECT @hash = HASHBYTES(&#39;SHA2_512&#39;, @asmBin);

EXEC sys.sp_add_trusted_assembly @hash = @hash, @description = @clrName;</code></pre></li>
</ul>
<h4 id="exit-criteria-18">Exit Criteria</h4>
<ul>
<li>Your Northwind database in SQL Server has the schema objects and the tables have data.</li>
</ul>
<h2 id="exercise-7-migrate-the-application">Exercise 7: Migrate the application</h2>
<p>Duration: 15 minutes</p>
<p>In this exercise, you will modify the NorthwindMVC application, so it targets SQL Server 2017 instead of Oracle.</p>
<h3 id="task-1-create-a-new-entity-model-against-sql-server">Task 1: Create a new Entity Model against SQL Server</h3>
<h4 id="tasks-to-complete-20">Tasks to Complete</h4>
<ul>
<li><p>Modify the web.config so that SqlServerConnectionString is correct for your environment.</p></li>
<li><p>Delete the existing entity model present in the files under the Data folder in Solution explorer.</p></li>
<li><p>Connect to the SQL Server database through Server Explorer in Visual Studio.</p></li>
<li><p>Create a new Code First model against the SQL Server database.</p></li>
</ul>
<h4 id="exit-criteria-19">Exit Criteria</h4>
<ul>
<li>You have successfully generated a new model.</li>
</ul>
<h3 id="task-2-modify-application-code">Task 2: Modify Application Code</h3>
<h4 id="tasks-to-complete-21">Tasks to Complete</h4>
<ul>
<li><p>Change the DataContext to use your SqlServerConnectionString.</p></li>
<li><p>Within HomeController.cs uncomment the SQL Server specific code and comment out the Oracle specific code.</p></li>
<li><p>Modify SALESBYYEAR.cs so that YEAR is of type int and SUBTOTAL is of type decimal.</p></li>
<li><p>Modify SalesByYearViewModel.cs so that Year is of type int.</p></li>
<li><p>Run the SALES_BY_YEAR_fix.sql</p></li>
</ul>
<h4 id="exit-criteria-20">Exit Criteria</h4>
<ul>
<li><p>You can run the application and see the dashboard showing correctly, this time with data coming from SQL Server.</p>
<figure>
<img src="images/Hands-onlabunguided-Dataplatformupgradeandmigrationimages/media/image18.png" title="View the dashboard" alt="This is a screenshot of the Northwind Traders Dashboard." /><figcaption>This is a screenshot of the Northwind Traders Dashboard.</figcaption>
</figure></li>
</ul>
<h2 id="after-the-hands-on-lab">After the hands-on lab</h2>
<p>Duration: 10 mins</p>
<p>In this exercise, attendees will deprovision any Azure resources that were created in support of the lab. You should follow all steps provided after attending the Hands-on lab.</p>
<h3 id="task-1-delete-the-resource-group">Task 1: Delete the resource group</h3>
<ol type="1">
<li><p>Using the Azure portal, navigate to the Resource group you used throughout this hands-on lab by selecting Resource groups in the left menu.</p></li>
<li><p>Search for the name of your research group, and select it from the list.</p></li>
<li><p>Select Delete in the command bar, and confirm the deletion by re-typing the Resource group name, and selecting Delete.</p></li>
</ol>
<p>You should follow all steps provided <em>after</em> attending the Hands-on lab.</p>
</body>
</html>
